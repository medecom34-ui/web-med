<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ | Med E-Commerce</title>
  <link rel="stylesheet" href="./assets/css/main.css" />
</head>
<body>
  
  <div class="topbar">
    <div class="container topbar__inner" id="authBar"></div>
  </div>

  <header class="header container">
    <a class="logo" href="index.html"><div class="logo__box">HOME</div></a>
    <!-- <div class="search"><input class="search__input" placeholder="р╕Др╣Йр╕Щр╕лр╕▓р╕кр╕┤р╕Щр╕Др╣Йр╕▓..." /><span class="search__icon">ЁЯФН</span></div> -->
  </header>

  <main class="container">
    <div class="auth-card">
      <div class="auth-tabs">
        <button class="tab active" data-tab="login">р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ</button>
        <button class="tab" data-tab="signup">р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б</button>
      </div>

      
      <form id="loginForm" class="auth-form show">
        <div class="form-group">
          <label>р╕нр╕╡р╣Ар╕бр╕е</label>
          <input type="email" id="loginEmail" required placeholder="name@example.com" />
        </div>
        <div class="form-group">
          <label>р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ</label>
          <input type="password" id="loginPassword" required placeholder="тАвтАвтАвтАв" />
        </div>
        <button type="submit" class="btn-primary w-full">р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ</button>
        <p class="auth-msg" id="loginMsg"></p>
      </form>

      
      <form id="signupForm" class="auth-form">
        <div class="form-group">
          <label>р╕Кр╕╖р╣Ир╕н-р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е</label>
          <input type="text" id="signupName" required placeholder="р╕Кр╕╖р╣Ир╕нр╕Вр╕нр╕Зр╕Др╕╕р╕У" />
        </div>
        <div class="form-group">
          <label>р╕нр╕╡р╣Ар╕бр╕е</label>
          <input type="email" id="signupEmail" required placeholder="name@example.com" />
        </div>
          <div class="form-group">
            <label>р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕гр╕ир╕▒р╕Юр╕Чр╣М</label>
            <input
              type="tel"
              id="signupPhone"
              placeholder="р╣Ар╕Кр╣Ир╕Щ 0891234567"
            />
          </div>
        <div class="form-group">
          <label>р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ</label>
          <input type="password" id="signupPassword" required minlength="4" placeholder="р╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 4 р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г" />
        </div>
        <button type="submit" class="btn-primary w-full">р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б</button>
        <p class="auth-msg" id="signupMsg"></p>
      </form>
    </div>
  </main>

  <script src="./assets/js/auth.js"></script>
  <script>
    
    const tabs = document.querySelectorAll('.auth-card .tab');
    const forms = {
      login: document.getElementById('loginForm'),
      signup: document.getElementById('signupForm')
    };
    tabs.forEach(b=>{
      b.addEventListener('click', ()=>{
        tabs.forEach(t=>t.classList.remove('active'));
        b.classList.add('active');
        Object.values(forms).forEach(f=>f.classList.remove('show'));
        forms[b.dataset.tab].classList.add('show');
      });
    });

    const params = new URLSearchParams(location.search);
    const nextUrl = params.get("next") || "index.html";

    
    document.getElementById('loginForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const email = loginEmail.value.trim();
      const pass  = loginPassword.value;

      const { ok, reason } = await window.Auth.login(email, pass);
      const msg = loginMsg;

      if(ok){
        msg.textContent = "р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╕кр╕│р╣Ар╕гр╣Зр╕И р╕Бр╕│р╕ер╕▒р╕Зр╕Юр╕▓р╣Др╕Ыр╕вр╕▒р╕Зр╕лр╕Щр╣Йр╕▓р╕Бр╣Ир╕нр╕Щр╕лр╕Щр╣Йр╕▓тАж";
        msg.className = "auth-msg ok";
        setTimeout(()=> location.href = nextUrl, 600);
      }else{
        msg.textContent = reason || "р╕нр╕╡р╣Ар╕бр╕ер╕лр╕гр╕╖р╕нр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З";
        msg.className = "auth-msg err";
      }
    });

    
    signupForm.addEventListener('submit', async e=>{
      e.preventDefault();

      const name  = signupName.value.trim();
      const email = signupEmail.value.trim();
      const phone = signupPhone.value.trim();   
      const pass  = signupPassword.value;

      const { ok, reason } = await window.Auth.signup({
        name,
        email,
        password: pass,
        phone,           
      });

      const msg = signupMsg;

      if(ok){
        msg.textContent = "р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И! р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Бр╕ер╣Йр╕зтАж";
        msg.className = "auth-msg ok";
        setTimeout(()=> location.href = nextUrl, 600);
      }else{
        msg.textContent = reason || "р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И";
        msg.className = "auth-msg err";
      }
    });

  </script>

</body>
</html>
